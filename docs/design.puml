@startuml
title AI Factory Benchmark - System Architecture

skinparam packageStyle rectangle
skinparam componentStyle rectangle

package "Local Machine" {
  [automation_script.sh] as AutoScript
  
  package "Docker Stack" {
    [FastAPI Server] as FastAPI
    [Grafana] as Grafana
  }
  
  database "Local Results" as LocalResults
}

package "MeluXina HPC" {
  [run_benchmark.sh] as RunBench
  [BenchmarkManager] as Manager
  
  package "Services" {
    [vLLM Server] as VLLM
    [MinIO Server] as MinIO
  }
  
  package "Workloads" {
    [vllm_inference.py] as VLLMClient
    [s3_upload.py] as S3Client
  }
  
  [PrometheusMonitor] as PromMon
  database "Remote Workspace" as RemoteWS
}

package "Recipes" {
  file "vLLM_InferenceRecipe.yaml" as VLLMRecipe
  file "S3_UploadRecipe.yaml" as S3Recipe
}

AutoScript --> RunBench : SSH + sbatch
AutoScript --> LocalResults : rsync fetch
AutoScript --> Grafana : starts

RunBench --> Manager : executes
Manager --> VLLMRecipe : loads
Manager --> S3Recipe : loads

Manager --> VLLM : starts
Manager --> MinIO : starts
Manager --> VLLMClient : launches
Manager --> S3Client : launches
Manager --> PromMon : starts

VLLMClient --> VLLM : HTTP requests
S3Client --> MinIO : S3 API calls
PromMon --> VLLM : scrapes /metrics
PromMon --> MinIO : scrapes /metrics
PromMon --> RemoteWS : saves JSON

FastAPI --> LocalResults : reads metrics
Grafana --> FastAPI : queries data

note right of AutoScript
  Entry point for users.
  Syncs code, submits job,
  fetches results, starts viz.
end note

note bottom of Manager
  Parses YAML recipes,
  manages service lifecycle,
  handles healthchecks.
end note

note right of FastAPI
  Grafana datasource API.
  Auto-detects service type.
  Calculates rate() for counters.
end note

@enduml
